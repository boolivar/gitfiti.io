export const GitfitiImage = {
  KITTY: [
    [0,0,0,4,0,0,0,0,4,0,0,0],
    [0,0,4,2,4,4,4,4,2,4,0,0],
    [0,0,4,2,2,2,2,2,2,4,0,0],
    [2,2,4,2,4,2,2,4,2,4,2,2],
    [0,0,4,2,2,3,3,2,2,4,0,0],
    [2,2,4,2,2,2,2,2,2,4,2,2],
    [0,0,0,3,4,4,4,4,3,0,0,0],
  ],

  ONEUP: [
    [0,4,4,4,4,4,4,4,0],
    [4,3,2,2,1,2,2,3,4],
    [4,2,2,1,1,1,2,2,4],
    [4,3,4,4,4,4,4,3,4],
    [4,4,1,4,1,4,1,4,4],
    [0,4,1,1,1,1,1,4,0],
    [0,0,4,4,4,4,4,0,0],
  ],

  ONEUP2: [
    [0,0,4,4,4,4,4,4,4,0,0],
    [0,4,2,2,1,1,1,2,2,4,0],
    [4,3,2,2,1,1,1,2,2,3,4],
    [4,3,3,4,4,4,4,4,3,3,4],
    [0,4,4,1,4,1,4,1,4,4,0],
    [0,0,4,1,1,1,1,1,4,0,0],
    [0,0,0,4,4,4,4,4,0,0,0],
  ],

  HACKERSCHOOL: [
    [4,4,4,4,4,4],
    [4,3,3,3,3,4],
    [4,1,3,3,1,4],
    [4,3,3,3,3,4],
    [4,4,4,4,4,4],
    [0,0,4,4,0,0],
    [4,4,4,4,4,4],
  ],

  OCTOCAT: [
    [0,0,0,4,0,0,0,4,0],
    [0,0,4,4,4,4,4,4,4],
    [0,0,4,1,3,3,3,1,4],
    [4,0,3,4,3,3,3,4,3],
    [0,4,0,0,4,4,4,0,0],
    [0,0,4,4,4,4,4,4,4],
    [0,0,4,0,4,0,4,0,4],
  ],

  OCTOCAT2: [
    [0,0,4,0,0,4,0],
    [0,4,4,4,4,4,4],
    [0,4,1,3,3,1,4],
    [0,4,4,4,4,4,4],
    [4,0,0,4,4,0,0],
    [0,4,4,4,4,4,0],
    [0,0,0,4,4,4,0],
  ],

  HELLO: [
    [0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,4],
    [0,2,0,0,0,0,0,0,0,2,0,2,0,0,0,0,0,4],
    [0,3,3,3,0,2,3,3,0,3,0,3,0,1,3,1,0,3],
    [0,4,0,4,0,4,0,4,0,4,0,4,0,4,0,4,0,3],
    [0,3,0,3,0,3,3,3,0,3,0,3,0,3,0,3,0,2],
    [0,2,0,2,0,2,0,0,0,2,0,2,0,2,0,2,0,0],
    [0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,4],
  ],

  HEART1: [
    [0,1,1,0,1,1,0],
    [1,3,3,1,3,3,1],
    [1,3,4,3,4,3,1],
    [1,3,4,4,4,3,1],
    [0,1,3,4,3,1,0],
    [0,0,1,3,1,0,0],
    [0,0,0,1,0,0,0],
  ],

  HEART2: [
    [0,5,5,0,5,5,0],
    [5,3,3,5,3,3,5],
    [5,3,1,3,1,3,5],
    [5,3,1,1,1,3,5],
    [0,5,3,1,3,5,0],
    [0,0,5,3,5,0,0],
    [0,0,0,5,0,0,0],
  ],

  HIREME: [
    [1,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [3,3,3,0,2,0,3,3,3,0,2,3,3,0,0,3,3,0,3,0,0,2,3,3],
    [4,0,4,0,4,0,4,0,0,0,4,0,4,0,0,4,0,4,0,4,0,4,0,4],
    [3,0,3,0,3,0,3,0,0,0,3,3,3,0,0,3,0,3,0,3,0,3,3,3],
    [2,0,2,0,2,0,2,0,0,0,2,0,0,0,0,2,0,2,0,2,0,2,0,0],
    [1,0,1,0,1,0,1,0,0,0,1,1,1,0,0,1,0,1,0,1,0,1,1,1],
  ],

  BEER: [
    [0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,3,3,3,0,3,3,3,0,0],
    [0,0,1,1,1,1,0,3,0,0,3,0,3,0,0,0,3,0,0,0,3,0,0,3,0],
    [0,2,2,2,2,2,0,3,0,0,3,0,3,0,0,0,3,0,0,0,3,0,0,3,0],
    [2,0,2,2,2,2,0,3,3,3,0,0,3,3,3,0,3,3,3,0,3,3,3,0,0],
    [2,0,2,2,2,2,0,3,0,0,3,0,3,0,0,0,3,0,0,0,3,0,3,0,0],
    [0,2,2,2,2,2,0,3,0,0,3,0,3,0,0,0,3,0,0,0,3,0,0,3,0],
    [0,0,2,2,2,2,0,3,3,3,0,0,3,3,3,0,3,3,3,0,3,0,0,3,0],
  ],

  GLIDERS: [
    [0,0,0,4,0,4,0,0,0,0,4,0,0,0],
    [0,4,0,4,0,0,4,4,0,0,0,4,0,0],
    [0,0,4,4,0,4,4,0,0,4,4,4,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,4,0,4,0,0,0,4,0,0,0,0,0,0],
    [0,0,4,4,0,4,0,4,0,0,0,0,0,0],
    [0,0,4,0,0,0,4,4,0,0,0,0,0,0],
  ],

  HEART: [
    [0,4,4,0,4,4,0],
    [4,2,2,4,2,2,4],
    [4,2,2,2,2,2,4],
    [4,2,2,2,2,2,4],
    [0,4,2,2,2,4,0],
    [0,0,4,2,4,0,0],
    [0,0,0,4,0,0,0],
  ],

  HEART_SHINY: [
    [0,4,4,0,4,4,0],
    [4,2,0,4,2,2,4],
    [4,0,2,2,2,2,4],
    [4,2,2,2,2,2,4],
    [0,4,2,2,2,4,0],
    [0,0,4,2,4,0,0],
    [0,0,0,4,0,0,0],
  ],
}

export class Gitfiti {
  image: number[][];
  offset: number;
  scale: number;

  contributionLevel = (x: number, y: number) => {
    const value = this.contributionCount(x, y);
    if (value === 0) return "level-0";
    if (value <= 5) return "level-1";
    if (value <= 10) return "level-2";
    if (value <= 15) return "level-3";
    return "level-4";
  }

  contributionCount =  (x: number, y: number) => {
    var ox = x - this.offset;
    return ox >= 0 && ox < this.image[0].length
      ? this.image[y][ox] * this.scale
      : 0;
  }

  constructor(image: number[][], offset: number = 0, scale: number = 4) {
    this.image = image;
    this.offset = offset;
    this.scale = scale;
  }

  generateScript(): string {
    var script = '';
    var date = this.fromDate();
    for (var col = 0; col < this.image[0].length; ++col) {
      for (var row = 0; row < this.image.length; ++row) {
        script += this.formatCommitLine(date).repeat(this.image[row][col] * this.scale);  
        date.setDate(date.getDate() + 1);
      }
    }
    return script;
  }

  formatCommitLine(timestamp: Date): string {
    var date = timestamp.toISOString().split('.')[0];
    return `GIT_AUTHOR_DATE=${date} GIT_COMMITTER_DATE=${date} git commit --allow-empty -m "gitfiti" > /dev/null\n`;
  }

  private fromDate(): Date {
    var date = this.nextSunday();
    date.setDate(date.getDate() - 53 * 7 + this.offset);
    date.setUTCHours(12, 0, 0, 0);
    return date;
  }

  private nextSunday(): Date {
    var date = new Date();
    date.setDate(date.getDate() + (7 - date.getDay()));
    return date;
  }
}