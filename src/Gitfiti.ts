export const GitfitiImage = {
  CUSTOM: Array(7).fill(null).map(() => Array(53).fill(0)),
  KITTY: [
    [0, 0, 0, 4, 0, 0, 0, 0, 4, 0, 0, 0],
    [0, 0, 4, 2, 4, 4, 4, 4, 2, 4, 0, 0],
    [0, 0, 4, 2, 2, 2, 2, 2, 2, 4, 0, 0],
    [2, 2, 4, 2, 4, 2, 2, 4, 2, 4, 2, 2],
    [0, 0, 4, 2, 2, 3, 3, 2, 2, 4, 0, 0],
    [2, 2, 4, 2, 2, 2, 2, 2, 2, 4, 2, 2],
    [0, 0, 0, 3, 4, 4, 4, 4, 3, 0, 0, 0],
  ],

  ONEUP: [
    [0, 4, 4, 4, 4, 4, 4, 4, 0],
    [4, 3, 2, 2, 1, 2, 2, 3, 4],
    [4, 2, 2, 1, 1, 1, 2, 2, 4],
    [4, 3, 4, 4, 4, 4, 4, 3, 4],
    [4, 4, 1, 4, 1, 4, 1, 4, 4],
    [0, 4, 1, 1, 1, 1, 1, 4, 0],
    [0, 0, 4, 4, 4, 4, 4, 0, 0],
  ],

  ONEUP2: [
    [0, 0, 4, 4, 4, 4, 4, 4, 4, 0, 0],
    [0, 4, 2, 2, 1, 1, 1, 2, 2, 4, 0],
    [4, 3, 2, 2, 1, 1, 1, 2, 2, 3, 4],
    [4, 3, 3, 4, 4, 4, 4, 4, 3, 3, 4],
    [0, 4, 4, 1, 4, 1, 4, 1, 4, 4, 0],
    [0, 0, 4, 1, 1, 1, 1, 1, 4, 0, 0],
    [0, 0, 0, 4, 4, 4, 4, 4, 0, 0, 0],
  ],

  HACKERSCHOOL: [
    [4, 4, 4, 4, 4, 4],
    [4, 3, 3, 3, 3, 4],
    [4, 1, 3, 3, 1, 4],
    [4, 3, 3, 3, 3, 4],
    [4, 4, 4, 4, 4, 4],
    [0, 0, 4, 4, 0, 0],
    [4, 4, 4, 4, 4, 4],
  ],

  OCTOCAT: [
    [0, 0, 0, 4, 0, 0, 0, 4, 0],
    [0, 0, 4, 4, 4, 4, 4, 4, 4],
    [0, 0, 4, 1, 3, 3, 3, 1, 4],
    [4, 0, 3, 4, 3, 3, 3, 4, 3],
    [0, 4, 0, 0, 4, 4, 4, 0, 0],
    [0, 0, 4, 4, 4, 4, 4, 4, 4],
    [0, 0, 4, 0, 4, 0, 4, 0, 4],
  ],

  OCTOCAT2: [
    [0, 0, 4, 0, 0, 4, 0],
    [0, 4, 4, 4, 4, 4, 4],
    [0, 4, 1, 3, 3, 1, 4],
    [0, 4, 4, 4, 4, 4, 4],
    [4, 0, 0, 4, 4, 0, 0],
    [0, 4, 4, 4, 4, 4, 0],
    [0, 0, 0, 4, 4, 4, 0],
  ],

  HELLO: [
    [0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 4],
    [0, 2, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0, 0, 0, 0, 0, 4],
    [0, 3, 3, 3, 0, 2, 3, 3, 0, 3, 0, 3, 0, 1, 3, 1, 0, 3],
    [0, 4, 0, 4, 0, 4, 0, 4, 0, 4, 0, 4, 0, 4, 0, 4, 0, 3],
    [0, 3, 0, 3, 0, 3, 3, 3, 0, 3, 0, 3, 0, 3, 0, 3, 0, 2],
    [0, 2, 0, 2, 0, 2, 0, 0, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0],
    [0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 4],
  ],

  HEART1: [
    [0, 1, 1, 0, 1, 1, 0],
    [1, 3, 3, 1, 3, 3, 1],
    [1, 3, 4, 3, 4, 3, 1],
    [1, 3, 4, 4, 4, 3, 1],
    [0, 1, 3, 4, 3, 1, 0],
    [0, 0, 1, 3, 1, 0, 0],
    [0, 0, 0, 1, 0, 0, 0],
  ],

  HEART2: [
    [0, 5, 5, 0, 5, 5, 0],
    [5, 3, 3, 5, 3, 3, 5],
    [5, 3, 1, 3, 1, 3, 5],
    [5, 3, 1, 1, 1, 3, 5],
    [0, 5, 3, 1, 3, 5, 0],
    [0, 0, 5, 3, 5, 0, 0],
    [0, 0, 0, 5, 0, 0, 0],
  ],

  HIREME: [
    [1, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [3, 3, 3, 0, 2, 0, 3, 3, 3, 0, 2, 3, 3, 0, 0, 3, 3, 0, 3, 0, 0, 2, 3, 3],
    [4, 0, 4, 0, 4, 0, 4, 0, 0, 0, 4, 0, 4, 0, 0, 4, 0, 4, 0, 4, 0, 4, 0, 4],
    [3, 0, 3, 0, 3, 0, 3, 0, 0, 0, 3, 3, 3, 0, 0, 3, 0, 3, 0, 3, 0, 3, 3, 3],
    [2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 2, 0, 0, 0, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0],
    [1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1],
  ],

  BEER: [
    [0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 0, 0, 3, 3, 3, 0, 3, 3, 3, 0, 3, 3, 3, 0, 0],
    [0, 0, 1, 1, 1, 1, 0, 3, 0, 0, 3, 0, 3, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 3, 0],
    [0, 2, 2, 2, 2, 2, 0, 3, 0, 0, 3, 0, 3, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 3, 0],
    [2, 0, 2, 2, 2, 2, 0, 3, 3, 3, 0, 0, 3, 3, 3, 0, 3, 3, 3, 0, 3, 3, 3, 0, 0],
    [2, 0, 2, 2, 2, 2, 0, 3, 0, 0, 3, 0, 3, 0, 0, 0, 3, 0, 0, 0, 3, 0, 3, 0, 0],
    [0, 2, 2, 2, 2, 2, 0, 3, 0, 0, 3, 0, 3, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 3, 0],
    [0, 0, 2, 2, 2, 2, 0, 3, 3, 3, 0, 0, 3, 3, 3, 0, 3, 3, 3, 0, 3, 0, 0, 3, 0],
  ],

  GLIDERS: [
    [0, 0, 0, 4, 0, 4, 0, 0, 0, 0, 4, 0, 0, 0],
    [0, 4, 0, 4, 0, 0, 4, 4, 0, 0, 0, 4, 0, 0],
    [0, 0, 4, 4, 0, 4, 4, 0, 0, 4, 4, 4, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 4, 0, 4, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0],
    [0, 0, 4, 4, 0, 4, 0, 4, 0, 0, 0, 0, 0, 0],
    [0, 0, 4, 0, 0, 0, 4, 4, 0, 0, 0, 0, 0, 0],
  ],

  HEART: [
    [0, 4, 4, 0, 4, 4, 0],
    [4, 2, 2, 4, 2, 2, 4],
    [4, 2, 2, 2, 2, 2, 4],
    [4, 2, 2, 2, 2, 2, 4],
    [0, 4, 2, 2, 2, 4, 0],
    [0, 0, 4, 2, 4, 0, 0],
    [0, 0, 0, 4, 0, 0, 0],
  ],

  HEART_SHINY: [
    [0, 4, 4, 0, 4, 4, 0],
    [4, 2, 0, 4, 2, 2, 4],
    [4, 0, 2, 2, 2, 2, 4],
    [4, 2, 2, 2, 2, 2, 4],
    [0, 4, 2, 2, 2, 4, 0],
    [0, 0, 4, 2, 4, 0, 0],
    [0, 0, 0, 4, 0, 0, 0],
  ],
};

export class Gitfiti {
  image: number[][];
  offset: number;
  scale: number;

  constructor(image: number[][], offset: number = 0, scale: number = 4) {
    this.image = image;
    this.offset = offset;
    this.scale = scale;
  }

  setValue(x: number, y: number, value: number) {
    this.image[y][x] = value;
  }

  contributionLevel(x: number, y: number): string {
    const value = this.contributionCount(x, y);
    if (value === 0) return "level-0";
    if (value <= 5) return "level-1";
    if (value <= 10) return "level-2";
    if (value <= 15) return "level-3";
    return "level-4";
  }

  contributionCount(x: number, y: number): number {
    var ox = x - this.offset;
    return ox >= 0 && ox < this.image[0].length
      ? this.image[y][ox] * this.scale
      : 0;
  }

  generateScript(): string {
    var script = "";
    var nowDate = new Date();
    var date = this.fromDate(nowDate);
    for (var x = 0; x < 53; ++x) {
      for (var y = 0; y < 7; ++y) {
        if (date <= nowDate) {
          script += this.formatCommitLine(date).repeat(
            this.contributionCount(x, y),
          );
        }
        date.setDate(date.getDate() + 1);
      }
    }
    return script;
  }

  formatCommitLine(timestamp: Date): string {
    var date = timestamp.toISOString().split(".")[0];
    return `GIT_AUTHOR_DATE=${date} GIT_COMMITTER_DATE=${date} git commit --allow-empty -m "gitfiti" > /dev/null\n`;
  }

  private fromDate(nowDate: Date): Date {
    var date = this.nextSunday(nowDate);
    date.setDate(date.getDate() - 53 * 7);
    date.setUTCHours(12, 0, 0, 0);
    return date;
  }

  private nextSunday(nowDate: Date): Date {
    var date = new Date(nowDate);
    date.setDate(date.getDate() + (7 - date.getDay()));
    return date;
  }
}
